<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title th:text="${title}">Default Title</title>
    <link rel="icon" th:src="@{/images/logo.png}">
    <link rel="stylesheet" th:href="@{/css-user/header.css}">
    <link rel="stylesheet" th:href="@{/css-user/footer.css}">
    <link rel="stylesheet" th:href="@{/css-user/popUp.css}">
    <link rel="stylesheet" th:href="@{/css-user/booknow.css}">
    <!-- css của login/signup-->
    <link rel="stylesheet" th:href="@{https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css}">
</head>
<body>
<!--Login/Signup-->
<div th:replace="view/partials/popUpForms :: popUpForms"></div>
<!-- Header-->
<div th:replace="view/partials/header :: header"></div>

<section class="bookNow-section">
    <div class="booking-container">
        <form id="booking-form" onsubmit="return validateForm()">
            <!-- Customer Information -->
            <div class="box customer-info">
                <h2>Customer Information</h2>
                <label for="name">Customer Name:</label>
                <input type="text" id="name" name="name" required>

                <label for="email">Email:</label>
                <input type="email" id="email" name="email" required>

                <label for="phone">Phone Number:</label>
                <input type="tel" id="phone" name="phone" required>

                <label for="date">Booking Date:</label>
                <input type="date" id="date" name="date" required>

                <label for="time">Time:</label>
                <input type="time" id="time" name="time" required>
            </div>

            <!-- Service Information -->
            <div class="box service-info">
                <h2>Service Information</h2>
                <h3>Choose a Service</h3>
                <div id="care-list"></div>

                <div id="staff-selection" style="display: none;">
                    <h3>Choose a Stylist</h3>
                    <div id="stylist-list"></div>

                    <!-- Staff Profile -->
                    <div id="staff-profile" class="staff-profile" style="display: none;">
                        <img id="staff-image" src="" alt="Profile Image">
                        <div id="staff-details"></div>
                    </div>
                </div>
            </div>

            <button type="submit">Book Appointment</button>
        </form>
    </div>
</section>

<!-- Footer -->
<div th:replace="view/partials/footer :: footer"></div>
</body>
</html>

<script>
    // Hàm để gọi API và hiển thị danh sách stylist
    function loadStylists(serviceId) {
        fetch('/api/booknow/stylists')
            .then(response => response.json())
            .then(stylists => {
                const stylistList = document.getElementById('stylist-list');
                stylistList.innerHTML = '';  // Clear any existing content

                if (stylists.length === 0) {
                    stylistList.innerHTML = '<p>No stylists available.</p>';
                } else {
                    stylists.forEach(stylist => {
                        const stylistItem = document.createElement('div');
                        stylistItem.classList.add('stylist-item');
                        stylistItem.innerHTML = `
                        <p><strong>${stylist.user.username}</strong></p>
                        <p><img src="data:image/jpeg;base64,${stylist.profilePicture}" alt="${stylist.user.username}" width="100" height="100"></p>
                        <p>${stylist.description}</p>
                        <p><strong>Status:</strong> ${stylist.available ? 'Available' : 'Not Available'}</p>
                    `;
                        stylistItem.addEventListener('click', function() {
                            // Khi chọn stylist, hiển thị thông tin chi tiết
                            displayStylistProfile(stylist);
                        });
                        stylistList.appendChild(stylistItem);
                    });
                }
            })
            .catch(error => {
                console.error('Error loading stylists:', error);
                alert('Could not load stylists. Please try again later.');
            });
    }

    // Hàm để hiển thị profile chi tiết của stylist khi chọn
    function displayStylistProfile(stylist) {
        const staffProfile = document.getElementById('staff-profile');
        const staffImage = document.getElementById('staff-image');
        const staffDetails = document.getElementById('staff-details');

        staffProfile.style.display = 'block';
        staffImage.src = `data:image/jpeg;base64,${stylist.profilePicture}`;
        staffDetails.innerHTML = `
        <p><strong>${stylist.user.username}</strong></p>
        <p>${stylist.description}</p>
        <p><strong>Status:</strong> ${stylist.available ? 'Available' : 'Not Available'}</p>
    `;
    }

    // Hàm để gọi API và hiển thị danh sách care services
    function loadCares() {
        fetch('/api/booknow/cares')
            .then(response => response.json())
            .then(cares => {
                const careList = document.getElementById('care-list');
                careList.innerHTML = '';  // Clear any existing content
                cares.forEach(care => {
                    const careItem = document.createElement('div');
                    careItem.classList.add('care-item');
                    careItem.innerHTML = `
                        <p><strong>${care.name}</strong></p>
                    `;
                    // Thêm sự kiện khi chọn dịch vụ
                    careItem.addEventListener('click', function() {
                        // Khi dịch vụ được chọn, hiển thị danh sách stylist
                        loadStylists(care.id);  // Truyền ID của dịch vụ
                        document.getElementById('staff-selection').style.display = 'block'; // Hiển thị chọn stylist
                    });
                    careList.appendChild(careItem);
                });
            })
            .catch(error => console.error('Error loading cares:', error));
    }

    // Gọi các hàm load dữ liệu khi trang tải
    window.onload = function() {
        loadCares(); // Chỉ gọi loadCares khi trang tải
    };
</script>

<!-- Cập nhật lại đường dẫn JS với th:src -->
<script th:src="@{/js/popUp.js}"></script>
