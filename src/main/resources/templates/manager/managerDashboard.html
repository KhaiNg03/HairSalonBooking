<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Manager - Dashboard</title>

    <!-- Bootstrap CSS -->
    <link rel="stylesheet" th:href="@{/webjars/bootstrap/css/bootstrap.min.css}" />

    <!-- Custom Styles -->
    <link rel="stylesheet" th:href="@{/css-admin/style.css}">

    <!-- Chart.js Script -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>

<header class="text-center">
    <h2>Manager Dashboard</h2>
</header>

<div class="container-fluid">
    <div class="row">
        <!-- Sidebar Menu -->
        <div th:replace="admin/fragment/asideAdmin :: asideAdmin"></div>

        <!-- Main Content Area -->
        <main class="col-md-10 p-4">
            <form th:action="@{/manageAppointments/yearly}" method="get">
                <input type="number" name="year" th:value="${selectedYear}" />
                <input type="number" name="month" th:value="${selectedMonth}" />
                <button type="submit">Submit</button>
            </form>

            <div class="container">
                <div class="text-center mb-4">
                    <h2>Manage Appointments</h2>
                </div>

                <!-- Revenue Overview Section -->
                <div class="text-center mb-4">
                    <h3>Dashboard</h3>
                </div>

                <!-- Display Total Price for the Year -->
                <div id="totalPriceContainer" class="text-center mb-4"></div>

                <!-- Chart for Revenue -->
                <canvas id="revenueChart" width="400" height="200"></canvas>
            </div>
        </main>

        <!-- Footer Content -->
        <footer class="text-center">
            <p>&copy; 2024 Hair Salon. All rights reserved.</p>
        </footer>
    </div>
</div>

<!-- Bootstrap JS -->
<script th:src="@{/webjars/bootstrap/js/bootstrap.bundle.min.js}"></script>

<script>
    // Giới hạn số tháng trong năm (1 đến 12)
    const months = Array.from({ length: 12 }, (_, i) => i + 1);

    // Hàm gọi API và hiển thị dữ liệu
    function fetchTotalPriceForMonth(year, month) {
        return fetch(`http://localhost:8080/manageAppointments/yearly?year=${year}&month=${month}`)
            .then(response => response.json())  // Giả sử API trả về dữ liệu dạng JSON
            .then(data => {
                return {
                    month: month,
                    totalPrice: data.totalPriceMonth || 0 // Nếu không có dữ liệu thì trả về 0
                };
            })
            .catch(error => {
                console.error('Error fetching data for month ' + month, error);
                return { month: month, totalPrice: 0 };  // Nếu lỗi, trả về 0
            });
    }

    // Hàm hiển thị tổng giá trị của mỗi tháng trong năm
    async function displayTotalPrices(year) {
        let totalPriceHtml = '<h4>Total Price for Each Month in ' + year + ':</h4><ul>';

        for (const month of months) {
            const { month: monthNum, totalPrice } = await fetchTotalPriceForMonth(year, month);
            totalPriceHtml += `<li>Month ${monthNum}: ${totalPrice}</li>`;
        }

        totalPriceHtml += '</ul>';

        // In ra kết quả
        document.getElementById('totalPriceContainer').innerHTML = totalPriceHtml;
    }

    // Gọi hàm hiển thị cho năm 2024
    displayTotalPrices(2024);
</script>

</body>
</html>
